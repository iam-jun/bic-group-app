default_platform(:android)

platform :android do
  desc "Submit a new Build to Diawi"
  lane :deploy_dev do
    Dotenv.overload '.development.env'
    gradle(task: "clean assembleProductionRelease")
    #buildNumber = prompt(
    #    text: "Please enter your build number:",
    #    multi_line_end_keyword: "END",
    #)
    gradle(
      task: "assemble",
      build_type: "Release",
      flavor: "Production",
      #properties: {
      #  "versionCode" => buildNumber.strip,
      #}
    )
    diawi(
      token: ENV['DIAWI_TOKEN'],
      file: lane_context[SharedValues::GRADLE_ALL_APK_OUTPUT_PATHS][2],
      timeout: 600,
    )
    rocket_chat(
      message: "New build version of Android can be download at: #{lane_context[SharedValues::UPLOADED_FILE_LINK_TO_DIAWI]}",
    )
  end

  desc "Submit a new Beta Build to Internal App Sharing"
  lane :develop do
    gradle(task: "clean assembleProductionRelease")
    upload_to_play_store_internal_app_sharing

    # sh "test.sh"
  end

  desc "Deploy a new version to the Google Play"
  lane :deploy do
    gradle(task: "clean assembleProductionRelease")
    upload_to_play_store
  end
end
